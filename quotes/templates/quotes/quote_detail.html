{% extends "base_sidebar_enclosed.html" %}
{% load bootstrap i18n %}

{% block section_title %}
    {% trans "Quote" %}
{% endblock %}

{% block sidebar %}

    {% if object.client.email and object.status == '1' %}
        <form method="post">
            {% csrf_token %}
            <a>
                <button type="submit" class="btn btn-default sidebar" id="send_brief">
                    {% trans "Send to Client" %}
                </button>
            </a>
        </form>
    {% endif %}

    <a href="{% url 'quote_pdf' object.id %}">
        <button type="button" class="btn btn-default sidebar">
            {% trans "Download Quote" %}
        </button>
    </a>
    <a href="{% url 'add_quote_template' quote_id=object.id %}">
        <button type="button" class="btn btn-default sidebar" title="Create template from this quote.">
            {% trans "Use as Template" %}
        </button>
    </a>
{% endblock %}

{% block center_content %}

    <div class="row">
        <div class="col-lg-10 col-md-10 col-sm-9 col-xs-9">
            <h2 class="section_title">{{ object.name }}</h2>
        </div>
        <div class="col-lg-2 col-md-2 col-sm-3 col-xs-3 action_box">
            <a href="{% url 'edit_quote' object.id %}" class="edit_button" title="{% trans "Edit" %}">
                <button id="section_edit" type="button" class="btn btn-default edit_button" aria-label="Edit">
                    <span class="glyphicon glyphicon-edit"/>
                </button>
            </a>
            <a href="{% url 'delete_quote' object.id %}" class="delete_button" title="{% trans "Delete" %}" onclick="return confirm('{% trans "Are you sure?" %}')"> 
                <button id="section_delete" type="button" class="btn btn-default delete_button" aria-label="Delete"> 
                    <span class="glyphicon glyphicon-trash"/> 
                </button>
            </a> 

        </div>
    </div>

    <div class="row object_data">
        <div class="col-lg-6">
            <p id="client" class="data"><span class="detail_title">{% trans "Client" %}:</span> {{ object.client.name }}</p>
            <br>
            <p id="status" class="data"><span class="label label-default">{{ object.get_status_display }}</span></p>
        </div>
    </div>


    <br/>

    <h2 class="section_title">
        {% trans 'Prices' %}
    </h2>
    <div class="prices">
        <div class="row">
            <div class="col-xs-offset-2 col-xs-3 section_content">
                <p>
                    <strong>{% trans "Service" %}</strong>
                </p>
            </div>
            <div class="col-xs-1 section_content">
                <p>
                    <strong>{% trans "Quantity" %}</strong>
                </p>
            </div>
            <div class="col-xs-2 section_content">
                <p>
                    <strong>{% trans "Unit Price" %}</strong>
                </p>
            </div>
            <div class="col-xs-2 section_content">
                <p>
                    <strong>{% trans "Subtotal" %}</strong>
                </p>
            </div>
        </div>
        {% for section in object.all_sections %}
            {% if section.service %}
                {% with service=section.service %}
                    <div class="row">
                        <div class="col-xs-offset-2 col-xs-3 section_content">
                            <p>
                                {{ service.name.get_text }}
                            </p>
                        </div>
                        <div class="col-xs-1 section_content">
                            <p>
                                {{ service.quantity }}
                            </p>
                        </div>
                        <div class="col-xs-2 section_content">
                            <p>
                                {{ service.cost }}
                            </p>
                        </div>
                        <div class="col-xs-2 section_content">
                            <p>
                                {{ service.get_total_cost }}
                            </p>
                        </div>
                    </div>
                {% endwith %}
            {% endif %}
        {% endfor %}

        <div class="row">
            <div class="col-xs-offset-6 col-xs-2 section_content">
                <p>
                    <strong>{% trans "Total" %}</strong>
                </p>
            </div>
            <div class="col-xs-2 section_content">
                <p>
                    <strong>{{ object.get_total_cost }}</strong>
                </p>
            </div>
        </div>
    </div>
    <br/>

    <h2 class="section_title">
        {% trans 'Quote Sections' %}
    </h2>

    <hr>


    {% if object.all_sections|length == 0 %}

        <a href="{% url 'edit_quote' object.id %}">{% trans "Click here to add sections." %}</a>

        <hr>

    {% endif %}

    {% for section in object.all_sections %}
        <div id="{{ section.name }}">
            <div>
                <div class="row">
                    <div class="col-lg-12">
                        <p>
                            {{ section.display_title }}:
                        </p>
                    </div>
                </div>

                {% if section.service %}
                    {% with service=section.service %}
                        <div class="row">
                            <div class="col-lg-12">
                                <h2 class="section_subtitle service_name">
                                    {{ service.name.get_text }}
                                </h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-4 col-xs-4">
                                <p>
                                    Type:
                                </p>
                            </div>
                            <div class="col-lg-10 col-md-10 col-sm-8 col-xs-8">
                                <p class="service_type">
                                    {{ service.get_type_display }}
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-4 col-xs-4">
                                <p>
                                    Description:
                                </p>
                            </div>
                            <div class="col-lg-10 col-md-10 col-sm-8 col-xs-8">
                                <p class="service_description">
                                    {{ service.description.get_text|linebreaks }}
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-4 col-xs-4">
                                <p>
                                    Cost:
                                </p>
                            </div>
                            <div class="col-lg-10 col-md-10 col-sm-8 col-xs-8">
                                <p class="service_cost">
                                    {{ service.cost }} &times; {{ service.quantity }}
                                </p>
                            </div>
                        </div>
                    {% endwith %}

                {% else %}

                    <div class="row">
                        <div class="col-lg-12">
                            <h2 class="section_subtitle">
                                {{ section.title.get_text }}
                            </h2>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <p>
                                {{ section.text.get_text|linebreaks }}
                            </p>
                        </div>
                    </div>

                {% endif %}
            </div>
        </div>

        <hr>

    {% endfor %}

    <br>

    <h2 class="section_title">
        Quote Totals
    </h2>

    <div class="row">
        <div class="col-lg-5 col-lg-offset-2">
            <p>
                <b>
                    Service name
                </b>
            </p>
        </div>
        <div class="col-lg-2">
            <p>
                <b>
                    Quantity
                </b>
            </p>
        </div>
        <div class="col-lg-3">
            <p>
                <b>
                    Subtotal Cost
                </b>
            </p>
        </div>
    </div>

    {% for section in object.all_sections %}
        {% if section.service %}
            <div class="row">
                <div class="col-lg-5 col-lg-offset-2">
                    <p>
                        {{ section.service.name.get_text }}
                    </p>
                </div>
                <div class="col-lg-2">
                    <p>
                        {{ section.service.quantity }}
                    </p>
                </div>
                <div class="col-lg-3">
                    <p>
                        {{ section.service.get_total_cost }}
                    </p>
                </div>
            </div>
        {% endif %}
    {% endfor %}

    <div class="row">
        <div class="col-lg-5 col-lg-offset-2">
            <p>
                <b>
                    Total
                </b>
            </p>
        </div>
        <div class="col-lg-3 col-lg-offset-2">
            <p>
                <b>
                    {{ object.get_total_cost }}
                </b>
            </p>
        </div>
    </div>

{% endblock %}