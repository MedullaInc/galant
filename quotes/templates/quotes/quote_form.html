{% extends "gallant/create_form.html" %}
{% load bootstrap i18n %}


{% block extra_form_inputs %}
    <table id="section_table" width="500">
        <tbody id="intro_section">
        <tr>
            <td>
                <label class="control-label  " for="id_intro">Intro</label>
                <button id="intro_remove" type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </td>
        </tr>
        <tr>
            <td>Title:&nbsp;&nbsp;</td>
            <td><input class="ultext form-control" id="id_intro" maxlength="512"
                       data='{{ object.intro.title.json }}'
                       name="intro_title" type="text" value="{{ object.intro.title.get_text }}"/></td>
        </tr>
        <tr>
            <td>Content:&nbsp;&nbsp;</td>
            <td><textarea class="ultext" name="intro_text" rows="5" style="width:100%;"
                          data='{{ object.intro.text.json }}'>{{ object.intro.text.get_text }}</textarea>
            </td>
        </tr>
        </tbody>
        <tbody id="margin_section">
        <tr>
            <td>
                <label class="control-label  " for="id_margin_section">Margin Section</label>
                <button id="intro_remove" type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </td>
        </tr>
        <tr>
            <td>Title:&nbsp;&nbsp;</td>
            <td><input class="ultext form-control" id="id_margin_section_title" maxlength="512"
                       data='{{ object.margin_section.title.json }}'
                       name="margin_section_title" type="text" value="{{ object.margin_section.title.get_text }}"/></td>
        </tr>
        <tr>
            <td>Content:&nbsp;&nbsp;</td>
            <td><textarea class="ultext" id="id_margin_section_text" name="margin_section_text" rows="5"
                          style="width:100%;"
                          data='{{ object.margin_section.text.json }}'>{{ object.margin_section.text.get_text }}</textarea>
            </td>
        </tr>
        </tbody>
        {% for section in object.sections.all %}
            <tbody id="section_{{ forloop.counter }}">
            <tr>
                <td>
                    <label class="control-label"
                           for="id_section_{{ forloop.counter }}">Section {{ forloop.counter }}</label>
                    <button id="section_{{ forloop.counter }}_remove" type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                    </button>
                </td>
            </tr>
            <tr>
                <td>Title:&nbsp;&nbsp;</td>
                <td><input class="form-control ultext" id="id_section_{{ forloop.counter }}_title" maxlength="512"
                           name="section_{{ forloop.counter }}_title" type="text" value="{{ section.title.get_text }}"/>
                </td>
            </tr>
            <tr>
                <td>Content:&nbsp;&nbsp;</td>
                <td><textarea id="id_section_{{ forloop.counter }}_text" class="ultext"
                              name="section_{{ forloop.counter }}_text" rows="5"
                              style="width:100%;">{{ section.text.get_text }}</textarea></td>
            </tr>
            </tbody>
        {% endfor %}
        <tr>
            <td></td>
            <td>
                <button type="button" id="add_section" class="btn btn-default" style="float: right">Add Section</button>
            </td>
        </tr>
    </table>
{% endblock %}

{% block extra_body %}
    <script>
        counter = 0;
        section = function (ct) {
            return '<tbody id="section_' + ct + '">' +
                    '<tr><td>' +
                    '   <label class="control-label" for="id_section_' +
                    ct + '">Section ' + ct + '</label>' +
                    '   <button id="section_' + ct + '_remove" type="button" class="close" data-dismiss="alert" aria-label="Close">' +
                    '        <span aria-hidden="true">&times;</span>' +
                    '    </button>' +
                    '</td></tr>' +
                    '<tr><td></td></tr>\n' +
                    '<tr>\n' +
                    '    <td>Title:&nbsp;&nbsp;</td>\n' +
                    '    <td><input class="ultext form-control" id="id_section_' + ct + '_title" maxlength="512"\n' +
                    '           name="section_' + ct + '_title" type="text" data=""/></td>\n' +
                    '</tr>\n' +
                    '<tr>\n' +
                    '    <td>Content:&nbsp;&nbsp;</td>\n' +
                    '    <td><textarea id="id_section_' + ct + '_text" class="ultext" name="section_' +
                    ct + '_text" rows="5" style="width:100%;"  data=""></textarea></td>\n' +
                    '</tr>\n' +
                    '</tbody>';
        };

        renameSections = function () {
            $('#section_table > tbody[id^="section_"]').each(function (i) {
                var name = 'section_' + ++i;
                var id = 'id_section_' + i;
                this.setAttribute('id', name);
                $(this).find('label').attr('for', 'id_' + name);
                $(this).find('label').text('Section ' + i);
                $(this).find('input').attr('id', id + '_title');
                $(this).find('input').attr('name', name + '_title');
                $(this).find('textarea').attr('id', id + '_text');
                $(this).find('textarea').attr('name', name + '_text');
            });
        };

        $('#add_section').click(function () {
            counter++;
            $('#section_table > tbody:last').before(section(counter));
            renameSections();
        });

        $(document.body).on('click', '.close', function () {
            del = confirm("Remove section?")
            if (del) {
                $(this).parents('tbody')[0].remove();
                counter--;
                renameSections();
            }
        });
    </script>
{% endblock %}