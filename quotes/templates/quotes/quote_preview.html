{% load staticfiles bootstrap i18n %}

<!DOCTYPE html>
<html lang="en">
<head>
    {% block head %}
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{% block head_title %}Galant{% endblock head_title %}</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="{% static "css/flat-ui.css" %}">
        <link rel="stylesheet" href="{% static "css/icon-font.css" %}">
        <link rel="stylesheet" href="{% static "css/animations.css" %}">
        <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="{% static "js/jquery-latest.min.js" %}"></script>
        <script src="{% static "js/bootstrap.min.js" %}"></script>
        <script src="{% static "js/flat-ui.min.js" %}"></script>
        <script src="{% static "js/modernizr.custom.js" %}"></script>
        <script src="{% static "js/page-transitions.js" %}"></script>
        <script src="{% static "js/startup-kit.js" %}"></script>
        <script src="{% static "js/gallant.js" %}"></script>

        <link rel="stylesheet" href="{% static "css/quote.css" %}">

        <script>

        $(document).ready(function(){

            // Initialize variables
            var page_height = 0;
            var page_number = 0;

            // Go through each page-wrapper instance.
            function check_page_height() {

                $('body').find(".page-wrapper").each(function (page_index) {

                    // Initialize variables
                    var pdf_elements = [];

                    //page_height = 643; // Use this for local testing.
                    page_height = 4970; // Use this for wkhtmltopdf.

                    // Go through each pdf_element instance.
                    $(this).find('.pdf_element').each(function (index) {

                        // Subtract pdf_element height to page_height.
                        page_height = page_height - $(this).height();

                        if ( page_height >= 0 ) {
                            // If page_height is greater than 0, assign a class "in_page", remove class "not_in_page"
                            $(this).addClass("in_page");
                            $(this).removeClass("not_in_page");
                        } else {
                            $(this).removeClass("in_page");
                            $(this).addClass("not_in_page");
                        }
                    });

                    // Set page number correctly
                    page_number = page_index + 1;
                    $(this).find('footer #page_number').html('<strong>'+ page_number +' / '+ $(".page-wrapper").length + '</strong>');

                    // If page_height is lower than 0, select elements with "not_in_page" class, call create new page function with elements array.
                    if ( page_height < 0 ) {
                        pdf_elements = $(this).parent().find('.pdf_element.not_in_page');

                        // Remove elements from page-wrapper element
                        $(this).find('.pdf_element.not_in_page').each(function() {
                            $(this).remove();
                        });

                        // Pass removed elements to build new page
                        if (pdf_elements.length > 0) {
                            add_new_page(pdf_elements, page_index + 1);
                        }
                    }

                });

            };

            function add_new_page(pdf_elements,page_id) {

                // Append new page-wrapper element to body.
                $('body').append('<div class="page-wrapper" id="page_'+ page_id +'"></div>');

                // Copy header, content, footer
                $('header').first().clone().appendTo('#page_'+page_id);
                $('#page_'+page_id).append('<section class="content"><div class="holder v-center"><div class="container" id="container_page_'+ page_id +'"></div></div></div>')
                $('footer').first().clone().appendTo('#page_'+page_id);

                // Insert pdf_elements in content's container element
                $.each(pdf_elements, function(key,element){
                    $('#container_page_'+ page_id +'').append(element);
                });

                // Run check_page_height() again to continue building pages if needed
                check_page_height();

            };

            check_page_height();

        });

        </script>

    {% endblock head %}
    {% block extra_head %}
    {% endblock extra_head %}
</head>
<body>
{% block body %}

    <div class="page-wrapper">

        <header class="header">
            <div class="container">
                <div class="row header_top">
                    <div class="col-xs-12">
                        <p>
                            <strong>{{ object.client.name }}</strong><br/>
                            {{ object.name }}
                        </p>
                    </div>
                </div>
                <div class="row header_bottom">
                    <div class="col-xs-4">
                        <p>
                            <strong>{{ object.user.name }}</strong><br/>
                            {{ object.user.email }}<br/>
                            {{ object.user.contact_info.phone_number }}
                        </p>
                    </div>
                    <div class="col-xs-4">
                        <p>
                            <strong>{% trans "Address" %}</strong><br/>
                            {{ object.user.contact_info.address }}<br/>
                            {{ object.user.contact_info.address_2 }}<br/>
                        </p>
                    </div>
                    <div class="col-xs-4">
                        <p>
                            <br/>
                            {{ object.user.contact_info.city }},
                            {{ object.user.contact_info.state }}<br/>
                            {{ object.user.contact_info.country }} {{ object.user.contact_info.zip }}<br/>
                        </p>
                    </div>
                </div>
            </div>
        </header>

        <section class="content">
            <div class="holder v-center">
                <div class="container">
                    {% for section in object.all_sections %}
                        {% if section.service %}
                            {% with service=section.service %}
                                <div class="pdf_element not_in_page">

                                    <div class="row">
                                        <div class="col-xs-offset-2 col-xs-8 section_title">
                                            <h2>
                                                {{ service.name.get_text }}
                                            </h2>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-offset-4 col-xs-8 section_content">
                                            {{ service.description.get_text|linebreaks }}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-offset-4 col-xs-4 section_content">
                                            <p>
                                                {% trans "Service Cost:" %}
                                            </p>
                                        </div>
                                        <div class="col-xs-4 section_content">
                                            <p>
                                                {{ service.cost }} &times; {{ service.quantity }}
                                            </p>
                                        </div>
                                    </div>

                                </div>
                            {% endwith %}
                        {% else %}
                            <div class="pdf_element not_in_page">
                                <div class="row">
                                    <div class="col-xs-offset-2 col-xs-8 section_title">
                                        <h2>
                                            {{ section.title.get_text }}
                                        </h2>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-offset-4 col-xs-8 section_content">
                                        {{ section.text.get_text|linebreaks }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                    <div class="pdf_element not_in_page">
                        <div class="row">
                            <div class="col-xs-offset-2 col-xs-10 section_title">
                                <h2>
                                    {% trans "Prices" %}
                                </h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-offset-4 col-xs-2 section_content">
                                <p>
                                    <strong>{% trans "Service" %}</strong>
                                </p>
                            </div>
                            <div class="col-xs-2 section_content">
                                <p>
                                    <strong>{% trans "Quantity" %}</strong>
                                </p>
                            </div>
                            <div class="col-xs-2 section_content">
                                <p>
                                    <strong>{% trans "Unit Price" %}</strong>
                                </p>
                            </div>
                            <div class="col-xs-2 section_content">
                                <p>
                                    <strong>{% trans "Subtotal" %}</strong>
                                </p>
                            </div>
                        </div>
                        {% for section in object.all_sections %}
                            {% if section.service %}
                                {% with service=section.service %}
                                    <div class="row">
                                        <div class="col-xs-offset-4 col-xs-2 section_content">
                                            <p>
                                                {{ service.name.get_text }}
                                            </p>
                                        </div>
                                        <div class="col-xs-2 section_content">
                                            <p>
                                                {{ service.quantity }}
                                            </p>
                                        </div>
                                        <div class="col-xs-2 section_content">
                                            <p>
                                                {{ service.cost }}
                                            </p>
                                        </div>
                                        <div class="col-xs-2 section_content">
                                            <p>
                                                {{ service.get_total_cost }}
                                            </p>
                                        </div>
                                    </div>
                                {% endwith %}
                            {% endif %}
                        {% endfor %}

                        <div class="row">
                            <div class="col-xs-offset-8 col-xs-2 section_content">
                                <p>
                                    <strong>{% trans "Total" %}</strong>
                                </p>
                            </div>
                            <div class="col-xs-2 section_content">
                                <p>
                                    <strong>{{ object.get_total_cost }}</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="container">
                <div class="row content_footer">
                    <div class="col-xs-4">
                        <p>
                            {% trans "Created using" %} {{ site.domain }}
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-11">
                    </div>
                    <div class="col-xs-1">
                        <p class="pull-right" id="page_number">
                        </p>
                    </div>
                </div>
            </div>
        </footer>

    </div>

{% endblock body %}

{% block extra_body %}
{% endblock extra_body %}
</body>
</html>