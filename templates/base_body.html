{% extends "base.html" %}
{% load staticfiles bootstrap i18n gallant_tags %}

{% block extra_head %}

{% endblock extra_head %}

{% block body %}

    <div class="page-wrapper" {% block extra_wrapper_attrs %}{% endblock %}>

        {% block header_div %}
            {% if user.is_authenticated %}
            {% else %}
            <header {% block header_class %} class="header-5" {% endblock %}>
                <div class="container">
                    <div class="row">
                        {% block navbar %}
                            <nav class="navbar col-lg-12 col-md-12 col-sm-12 col-xs-12" role="navigation">
                                <div class="navbar-header">
                                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"></button>
                                    <a class="brand" href="/">{{ site.name }} <span>Beta</span></a>
                                </div>
                                <div id="menu" class="collapse navbar-collapse">
                                    <ul class="nav pull-right" id="dropdown-menu">
                                            {% comment %}
                                                <li><a href="">{% trans 'Features' %}</a></li>
                                                <li><a href="">{% trans 'Pricing' %}</a></li>
                                                <li><a href="{% url 'contact' %}">{% trans 'Contact' %}</a></li>
                                            {% endcomment %}
                                    </ul>
                                </div>
                            </nav>
                        {% endblock %}
                    </div>
                </div>
            </header>
            {% endif %}
        {% endblock %}

        {% block messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <button type='button' class='close' data-dismiss='alert'>&times;</button>
                    {{ message }}</div>
            {% endfor %}
        {% endblock %}

        {% url 'home' as home_url %}
        {% if request.get_full_path != home_url %}

            {% comment %}
            {% block sub_header %}
                {% if user.is_authenticated %}
                {% else %}
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-2">
                            <h2 class="app_title">
                                {% block old_title %}
                                    {% firstof title 'Menu' %}
                                {% endblock %}
                            </h2>
                        </div>
                        {% block breadcrumbs %}
                            <div id="breadcrumbs" class="col-xs-12 col-sm-12 col-md-12 {% if user.is_authenticated %}col-lg-5{% else %}col-lg-10{% endif %}">
                                <div class="breadcrumbs">
                                    {% for breadcrumb in request.breadcrumbs %}
                                        <a href="{{ breadcrumb.url }}" {% if forloop.last %}class="active"{% endif %}>{{ breadcrumb.name }}</a>
                                        {% if not forloop.last %} <span>/</span> {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endblock %}
                    </div>
                </div>
                {% endif %}
            {% endblock %}
            {% endcomment %}

        {% endif %}

        {% block content_div %}

            <nav id="sidebar" class="sidebar" role="navigation">
                <!-- need this .js class to initiate slimscroll -->
                <div class="js-sidebar-content">
                    <header class="logo hidden-xs">
                    </header>
                    <ul class="sidebar-nav">
                        <li>
                            <a href="/">
                                <span class="icon">
                                    <i class="fa fa-desktop"></i>
                                </span>
                                Dashboard
                            </a>
                        </li>
                        <li class="active">
                            <a href="{% url 'clients' %}">
                                <span class="icon">
                                    <i class="fa fa-globe"></i>
                                </span>
                                {% trans 'Clients' %}
                            </a>
                            {% block client_sidebar %}
                            {% endblock %}
                        </li>
                        <li>
                            <a href="{% url 'quotes' %}">
                                <span class="icon">
                                    <i class="fa fa-money"></i>
                                </span>
                                {% trans 'Quotes' %}
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'projects' %}">
                                <span class="icon">
                                    <i class="fa fa-briefcase"></i>
                                </span>
                                {% trans 'Projects' %}
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'calendr' %}">
                                <span class="icon">
                                    <i class="fa fa-calendar"></i>
                                </span>
                                {% trans 'Calendar' %}
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <!-- This is the white navigation bar seen on the top. A bit enhanced BS navbar. See .page-controls in _base.scss. -->
            <nav class="page-controls navbar navbar-default">
                <div class="container-fluid">
                    <!-- .navbar-header contains links seen on xs & sm screens -->
                    <div class="navbar-header">
                        <ul class="nav navbar-nav">
                            <li>
                                <!-- whether to automatically collapse sidebar on mouseleave. If activated acts more like usual admin templates -->
                                <a class="hidden-sm hidden-xs" id="nav-state-toggle" href="#" title="Turn on/off sidebar collapsing" data-placement="bottom">
                                    <i class="fa fa-bars fa-lg"></i>
                                </a>
                                <!-- shown on xs & sm screen. collapses and expands navigation -->
                                <a class="visible-sm visible-xs" id="nav-collapse-toggle" href="#" title="Show/hide sidebar" data-placement="bottom">
                                    <span class="rounded rounded-lg bg-gray text-white visible-xs"><i class="fa fa-bars fa-lg"></i></span>
                                    <i class="fa fa-bars fa-lg hidden-xs"></i>
                                </a>
                            </li>
                        </ul>
                        <!-- xs & sm screen logo -->
                        <a class="navbar-brand visible-xs" href="index.html">
                            &nbsp;
                            {{ site.name }}
                            &nbsp;
                        </a>
                    </div>

                    <!-- this part is hidden for xs screens -->
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle dropdown-toggle-notifications" data-toggle="dropdown">
                                    <i class="fa fa-user fa-lg"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a>{{ user }}</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="{% url 'account_change_password' %}"><i class="glyphicon glyphicon-user"></i> &nbsp; Change Password</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li><a href="{% url 'account_logout' %}"><i class="fa fa-sign-out"></i> &nbsp; Log Out</a></li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-bell fa-lg"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a>No new notifications.</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="content-wrap">
                <!-- main page content. the place to put widgets in. usually consists of .row > .col-md-* > .widget.  -->
                <main id="content" class="content" role="main">
                    <h1 class="page-title app_title"">{% block page_title %}{{ title }}{% endblock %}</h1>
                    {% block content %}
                    {% endblock content %}
                </main>
            </div>
            <!-- The Loader. Is shown when pjax happens -->
            <div class="loader-wrap hiding hide">
                <i class="fa fa-circle-o-notch fa-spin-fast"></i>
            </div>

        {% endblock %}

        {% block footer_div %}
            {% if user.is_authenticated %}
            {% else %}
            <footer class="footer-3">
                <div class="container">
                    <div class="row">

                        <div class="col-sm-4 col-xs-12">
                            {% trans 'Features' %}<br>
                            {% trans 'Pricing' %}<br>
                        </div>

                        <div class="col-sm-4 col-xs-12">
                            <a href="https://www.facebook.com/galantapp" target="_blank">{% trans 'Facebook' %}</a><br>
                            <a href="https://www.twitter.com/galantapp" target="_blank">{% trans 'Twitter' %}</a><br>
                        </div>

                        <div class="col-sm-4 col-xs-12">
                            {% trans 'Copyright Medulla Inc.' %} © {% now "Y" %}<br>
                            {% trans 'Terms & Conditions' %}<br>
                            {% trans 'Privacy Policy' %}
                        </div>

                    </div>
                </div>
            </footer>
            {% endif %}
        {% endblock %}

    </div>

    <div id="base_modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="section_title"></h2>
                </div>
                <div class="modal-body" style="height: 500px; overflow: auto;">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="feedback">
        <a>{% trans "Feedback" %}</a>
    </div>

    <script>
        $.noConflict();
        jQuery(document).ready(function ($) {

            $('#logged_in_as').height($('.breadcrumbs').height());
            $('#logged_in_as a').css("margin-left", -$('#logged_in_as a').width() / 2 + 'px');
            $('#logged_in_as a').css("margin-top", -$('#logged_in_as a').height() / 2 + 'px');

            $('ul [data-toggle=dropdown]').on('click', function (event) {
                event.preventDefault();
                event.stopPropagation();
                $(this).parent().siblings().removeClass('open');
                $(this).parent().toggleClass('open');
            });

            $("#feedback").animate({bottom: '-' + (($('#feedback').height() / 2) - 20) + 'px'}, 2000);
            $(".action-button.dropdown-toggle").dropdown();

        });

        jQuery('#feedback').click(function ($) {
            var app_title = $('.app_title').text().trim();
            if (app_title.length == 0) {
                app_title = "Main";
            }
            $.get("{% url 'feedback' %}?app_title=" + app_title, function (data) {
                $('#base_modal .section_title').html("Leave Feedback");
                $('#base_modal .modal-body').html(data);
                $('#base_modal #form').submit(function () {
                    $.post("{% url 'feedback' %}?path={{ request.path }}",
                            $(this).serialize(), function () {
                                $('#base_modal').modal('hide');
                                location.reload(true);
                            });
                    return false;
                });
                $('#base_modal').modal('show');
            });
        });

    </script>
{% endblock body %}