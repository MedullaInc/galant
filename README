Development environment setup
=============================

- Requirements: python, pip, virtualenv, python-dev (Ubuntu), MySQL, npm, gulp (npm install -g gulp)

- Optionally instal autoenv:

OSX
  $ brew install autoenv
  $ source /usr/local/opt/autoenv/activate.sh
  $ echo 'source /usr/local/opt/autoenv/activate.sh' >> ~/.bash_profile

Linux:
  $ git clone git://github.com/kennethreitz/autoenv.git ~/.autoenv
  $ source ~/.autoenv/activate.sh
  $ echo 'source ~/.autoenv/activate.sh' >> ~/.bashrc

- Default dev config is to have MySQL root user with no password, make sure to add "skip-networking" to your my.cnf if
  you do this. Create new database manually, named according to config (default gallant_dev). If your DB is set up
  differently, create a different config file and point the environment variable DJANGO_SETTINGS_MODULE to its path.

- Run ./scripts/setup.sh, or perform the following steps manually:

  - Create virtual environment (this will be activated by autoenv from .env when you cd to the project directory,
    but since you're already there you need to activate it manually):
    $ virtualenv venv

  - Install dependencies, run project setup:
    $ pip install -r requirements.txt 
    $ ./scripts/setup.sh

  - Run 'python manage.py makemigrations', 'python manage.py migrate'

  - Run 'npm install', then 'gulp' to load JS dependencies and copy static JS assets

  - For testing, install PhantomJS (for OS X download binary and copy to somewhere in PATH, eg /usr/bin)

  - For internationalization, install gettext & run 'python manage.py compilemessages'

  - For Quote PDFs, install wkhtmltopdf 0.12.2.1 (binaries available for win / linux / osx)

  - To load example Quote & Brief templates, run 'python manage.py load_quote' and/or 'load_brief'

  - For openexchangerates.org exchange rates, run 'python manage.py update_rates'

- Create a superuser with:
  $ python manage.py createsuperuser


Server Setup
============

- Install ngninx and Supervisor, copy config from scripts/nginx.sites-available.gallant and scripts/supervisord.conf to
  their respective locations.
- Install scripts/supervisord.init.d.script to /etc/init.d/supervisord
- Create django config file in gallant/settings/prod_ec2.py with proper values for DB / hostname, eg:
    DATABASES = {
        'default': {
            'NAME': 'gallant',
            'ENGINE': 'django.db.backends.mysql',
            'USER': 'root',
            'PASSWORD': '[enter password here]',
            'OPTIONS': {
              'autocommit': True,
            },
        }
    }

    ALLOWED_HOSTS = ['galant.co',]
- Run 'manage.py migrate', 'gulp production' (avoids copying unminified static JS files), and manage.py collectstatic -l
- scripts/gunicorn_start will be run from supervisord with DJANGO_SETTINGS_MODULE=gallant.settings.prod_ec2
- Run nginx / Supervisor with 'sudo service nginx start' and 'sudo service supervisord start'
- To refresh the app (eg after 'git pull' / 'gulp production' / collectstatic) and restart, run
  'sudo supervisorctl restart all'

