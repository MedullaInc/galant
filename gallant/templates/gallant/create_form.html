{% extends "base_sidebar.html" %}
{% load staticfiles bootstrap i18n %}

{% block extra_head %}
    <script src="{% static "js/input_mask/jquery.inputmask.js" %}"></script>
    <script src="{% static "js/input_mask/jquery.bind-first.min.js" %}"></script>
    <script src="{% static "js/input_mask/jquery.inputmask-multi.js" %}"></script>
{% endblock extra_head %}

{% block section_title %}
    {{ title }}
{% endblock %}

{% block center_content %}

    <form id="main_form" class="form" method="post">

        {% block form_help_text %}
            {% if help_text %}
                <p class="title">
                    <i>
                        {{ help_text }}
                    </i>
                </p>
            {% endif %}
        {% endblock %}

        {% csrf_token %}
        {% block pre_form %}{% endblock %}
        {% block form_body %}
            {{ form|bootstrap }}
        {% endblock %}
        {% block post_form %}{% endblock %}

        <div id="form_actions">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-actions">
                        {% block form_actions %}
                            <button id="create_submit" class="btn btn-default pull-left" type="submit">
                                {{ submit_text|default:_("Save") }}
                            </button>
                        {% endblock %}
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script>
        // Save form contents
        $('.form').each(function () {
            $(this).data('serialize', $(this).serialize());
        });

        var confirmOnPageExit = function (e) {
            var modified = false;
            $('.form').each(function () {
                if ($(this).serialize() != $(this).data('serialize')) {
                    modified = true;
                    return false;
                }
            });

            $('.ultext_target, .ultext_array_target').each(function () {
                if ($(this).val() != $(this).data('val')) {
                    modified = true;
                    return false;
                }
            });

            if (!modified) {
                return null;
            }

            // If we haven't been passed the event get the window.event
            e = e || window.event;

            var message = 'You have unsaved changes. If you leave this page they will be lost.';

            // For IE6-8 and Firefox prior to version 4
            if (e) {
                e.returnValue = message;
            }

            // For Chrome, Safari, IE8+ and Opera 12+
            return message;
        };

        // Turn it on - assign the function that returns the string
        window.onbeforeunload = confirmOnPageExit;

        $('.form').submit(function () {
            window.onbeforeunload = null;
        });

        // Input mask for phone numbers
        $(document).ready(function () {
            if ($('.form').find("#id_phone_number").length > 0) {

                var maskList = $.masksSort($.masksLoad("{% static "js/input_mask/phone-codes.json" %}"), ['#'], /[0-9]|#/, "mask");
                var maskOpts = {
                    inputmask: {
                        definitions: {
                            '#': {
                                validator: "[0-9]",
                                cardinality: 1
                            }
                        },
                        //clearIncomplete: true,
                        showMaskOnHover: false,
                        autoUnmask: true
                    },
                    match: /[0-9]/,
                    replace: '#',
                    list: maskList,
                    listKey: "mask",
                };

                $('#id_phone_number').inputmasks(maskOpts);
                
            }
        });
    </script>
{% endblock %}