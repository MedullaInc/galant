{% extends "base_body.html" %}
{% load bootstrap i18n gallant_tags staticfiles %}

{% block page_title %}
    {{ object.name }} - <span class="fw-semi-bold">Dashboard</span>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script src="{% static "js/Chart.min.js" %}"></script>
    <script src="{% static "js/angular-animate.js" %}"></script>
    <script src="{% static "djng/js/django-angular.js" %}"></script>
    <script src="{% static "js/tc-angular-chartjs.js" %}"></script>
{% endblock %}

{% block project_scripts %}
    {{ block.super }}
    {% if DEBUG %}
        <script src="{% static "js/quotes.js" %}"></script>
        <script src="{% static "js/briefs.js" %}"></script>
    {% endif %}
{% endblock %}

{% block extra_wrapper_attrs %} ng-app="glClientPayments" {% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static "gallant/css/chart.css" %}">
{% endblock %}

{% block client_sidebar %}
    <a class="collapsed" href="#sidebar-ui" data-toggle="collapse" data-parent="#sidebar">
        <span class="icon">
            <i class="fa fa-building"></i>
        </span>
        {{ object.name }}
        <i class="toggle fa fa-angle-down"></i>
    </a>
    <ul id="sidebar-ui" class="collapse">
        {% url 'client_detail' object.id as client_detail %}
        <li><a href="{{ client_detail }}">Dashboard</a></li>
        {% url 'client_work_detail' object.id as client_work_detail %}
        <li><a href="{{ client_work_detail }}">Projects</a></li>
        {% url 'client_money_detail' object.id as client_money_detail %}
        <li><a href="{{ client_money_detail }}">Payments</a></li>
        <li role="separator" class="divider"></li>
        <li><a href="{% url 'briefs' %}?client_id={{ object.id }}">Briefs</a></li>
        <li><a href="{% url 'quotes' %}?client_id={{ object.id }}">Quotes</a></li>
    </ul>
{% endblock %}

{% block content %}

    <script type="text/ng-template" id="addBriefPopoverTemplate.html">
        <a class="from_template_button" ng-click="open()">
            <button type="button" class="btn btn-success btn-sm mt brief_from_template_button">From Template</button>
        </a>
        <a ng-click="addBriefRedirect()">
            <button type="button" class="btn btn-success btn-sm mt brief_from_scratch_button">From Scratch</button>
        </a>
    </script>
    <script type="text/ng-template" id="briefTemplateModalContent.html">
        <div class="modal-header">
            <h2 class="section_title">Select Template</h2>
        </div>
        <div class="modal-body">
            <table st-table="briefTemplate" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th st-sort="name">{% trans "Name" %}</th>
                    <th st-sort="date">{% trans "Date" %}</th>
                    <th st-sort="language">{% trans "Language" %}</th>
                </tr>
                </thead>
                <tbody ng-include src="'{% static "briefs/html/br_brieftemplate_modal_rows.html" %}'"></tbody>
            </table>
        </div>
    </script>

    <script type="text/ng-template" id="addQuotePopoverTemplate.html">
        <a class="from_template_button" ng-click="open()">
            <button type="button" class="btn btn-success btn-sm mt quote_from_template_button">From Template</button>
        </a>
        <a ng-click="addQuoteRedirect()">
            <button type="button" class="btn btn-success btn-sm mt quote_from_scratch_button">From Scratch</button>
        </a>
    </script>
    <script type="text/ng-template" id="quoteTemplateModalContent.html">
        <div class="modal-header">
            <h2 class="section_title">Select Template</h2>
        </div>
        <div class="modal-body">
            <table st-table="quoteTemplate" class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th st-sort="name">{% trans "Name" %}</th>
                    <th st-sort="date">{% trans "Date" %}</th>
                    <th st-sort="language">{% trans "Language" %}</th>
                </tr>
                </thead>
                <tbody ng-include src="'{% static "quotes/html/qt_quotetemplate_modal_rows.html" %}'"></tbody>
            </table>
        </div>
    </script>

    {% block client_detail %}

        <div class="row">
            <div class="col-md-6">
                {% block main_client_data %}
                    <section class="widget">
                        <div class="widget-body">
                            <div class="widget-top-overflow text-white">
                                <div class="height-100 overflow-hidden">
                                    <img class="img-responsive" src="{% static "img/galant/background.jpg" %}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-5 text-center">
                                    <div class="post-user post-user-profile">
                                        <h4 class="fw-normal">{{ object.name }}</h4>
                                        <span class="label label-danger"> {{ object.get_status_display }} </span>

                                        <ul class="contacts">
                                        {% if object.contact_info.phone_number %}
                                            <li>
                                                <i class="fa fa-phone fa-fw mr-xs"></i>{{ object.contact_info.phone_number }}
                                            </li>
                                        {% endif %}
                                            <li>
                                                <i class="fa fa-envelope fa-fw mr-xs"></i><a href="#"> {{ object.email }}</a>
                                            </li>
                                            {% if object.contact_info.country %}
                                            <li>
                                                <i class="fa fa-map-marker fa-fw mr-xs"></i>
                                                {{ object.contact_info.city }}{% if object.contact_info.city and object.contact_info.country %}, {% endif %}{{ object.contact_info.country }}
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-sm-7">
                                    <div class="stats-row stats-row-profile mt text-right">
                                        <div class="stat-item">
                                            <p class="value">{{ object.get_language_display }}</p>
                                            <h5 class="name">Language</h5>
                                        </div>
                                        <div class="stat-item">
                                            <p class="value">{{ object.currency }}</p>
                                            <h5 class="name">Currency</h5>
                                        </div>
                                        <div class="stat-item">
                                            <p class="value">{{ object.contact_info.country }}</p>
                                            <h5 class="name">Country</h5>
                                        </div>
                                    </div>
                                    <p class="text-right mt-lg">
                                        <a href="{% url 'edit_client' object.id %}" class="btn btn-warning btn-sm mt" title="{% trans "Edit" %}">
                                            &nbsp;Edit
                                            &nbsp;&nbsp;<i class="glyphicon glyphicon-edit"/></i>&nbsp;
                                        </a>
                                        <a href="{% url 'delete_client' object.id %}" class="btn btn-danger btn-sm mt" title="{% trans "Delete" %}" onclick="return confirm('{% trans "Are you sure?" %}')"> 
                                            &nbsp;Delete
                                            &nbsp;&nbsp;<i class="glyphicon glyphicon-trash"/></i>&nbsp;
                                        </a> 

                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>
                    <span gl-client-work-chart client-id="{{ object.id }}" add-brief-url='{% url 'add_brief' %}' language='{% firstof language LANGUAGE_CODE %}'>
                    </span>
                    <span gl-client-money-chart client-id="{{ object.id }}" add-quote-url='{% url 'add_quote' %}' language='{% firstof language LANGUAGE_CODE %}'>
                    </span>
                {% endblock %}
            </div>
            <div class="col-md-6">
                {% block client_notes %}
                <section id="notes" class="activities">
                    <h2>Notes</h2>

                    {% objects_for object.notes as notes %}
                    {% if notes|length > 0 %}
                        {% for item in notes %}
                            {% include "gallant/note.html" %}
                        {% endfor %}
                    {% else %}
                        <section class="event">
                            <p class="fs-mini">
                                No notes have been added for this client yet.
                            </p>
                            <footer>
                            </footer>
                        </section>
                    {% endif %}
                    {% include "gallant/add_note.html" %}
                </section>
                {% endblock %}
            </div>
        </div>

        <br/>
    {% endblock %}

    {% block client_alerts %}
    {% endblock %}

{% endblock %}

{% block extra_body %}
    <div id="add_button_popover" class="popover" style="display: none">
        <a class="brief_from_template_button">
            <button type="button" class="btn btn-default from_template_button">From Template</button>
        </a>
        <a href="{% url 'add_brief' %}?client_id={{ object.id }}">
            <button type="button" id="brief_from_scratch" class="btn btn-default from_scratch_button">From Scratch</button>
        </a>
    </div>
    <div id="template_select" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h2 class="section_title">Select Template</h2>
                </div>
                <div class="modal-body" style="height: 500px; overflow: auto;">
                    <table class="table table-striped table-bordered">
                        <thead>
                        <th><b>{% trans "Name" %}</b></th>
                        <th><b>{% trans "Date" %}</b></th>
                        <th><b>{% trans "Language" %}</b></th>
                        </thead>
                        {% for template in template_list %}
                            <tr data-rel="{{ template.id }}" style="cursor: pointer" class="template_row">
                                <td>{{ template.brief.name }}</td>
                                <td>{{ template.brief.modified|date:'Y-m-d H:i' }}</td>
                                <td>
                                    {% if template.language_list %}
                                        <select class="template_lang form-control" name="language">
                                            {% for code, language in template.language_list %}
                                                <option value="{{ code }}">{{ language }}</option>
                                            {% endfor %}
                                        </select>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4">
                                    No templates yet,
                                    <a href="{% url "add_brief_template" %}">click here to add one.</a>
                                </td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
                <div class="modal-footer">
                </div>
            </div>

        </div>
    </div>
{% endblock %}